<!DOCTYPE html>
<html>
<head>
    <title>Login - Voting App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div class="bg-white p-8 rounded-lg shadow-md w-96 text-center">
        <h1 class="text-3xl text-gray-800 mb-6">Login</h1>
        <form id="loginForm" class="flex flex-col">
            <input type="text" id="username" name="username" placeholder="Username" required
                   class="p-3 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <input type="password" id="password" name="password" placeholder="Password" required
                   class="p-3 mb-6 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button type="submit"
                    class="bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition duration-300 ease-in-out text-lg">
                Login
            </button>
        </form>
        <p id="errorMessage" class="text-red-500 mt-4" style="display:none;"></p>
    </div>

    <script>
        document.getElementById("loginForm").addEventListener("submit", async function(event) {
            event.preventDefault(); // Prevent default form submission

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const errorMessageElement = document.getElementById("errorMessage");
            errorMessageElement.style.display = "none"; // Hide any previous error message

            const formData = new FormData();
            formData.append("username", username);
            formData.append("password", password);

            try {
                const response = await fetch('http://localhost:8000/login', {
                    method: 'POST',
                    body: formData // Send as FormData
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log("Login response data:", data); // Add this line for debugging
                    console.log("Received role:", data.role); // Add this line for debugging
                    if (data.role === "admin") {
                        window.location.href = "/admin.html";
                    } else {
                        window.location.href = "/votepage.html";
                    }
                } else {
                    const errorData = await response.json();
                    errorMessageElement.textContent = errorData.detail || "Login failed. Please check your credentials.";
                    errorMessageElement.style.display = "block"; // Show the error message
                }
            } catch (error) {
                console.error('Login error:', error);
                errorMessageElement.textContent = "An unexpected error occurred. Please try again later.";
                errorMessageElement.style.display = "block";
            }
        });
    </script>
</body>
</html>